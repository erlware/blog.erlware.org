<!DOCTYPE html>
<html lang="en-us" />
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>Sinan Releases and Being Right &middot; Erlware Blog</title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="canonical" href="/sinan-releases-and-being-right/" />

     <meta name="description" content="Fred, of Learn You Some Erlang for Great Good, today posted on his blog about the problems around how rebar handles releases, Rebar Releases and Being Wrong. Th" /> 

     
    
    <meta name="twitter:card" content="summary"/>
    
 
    <meta name="twitter:title" content="Sinan Releases and Being Right"/>
    <meta name="twitter:description" content="Fred, of Learn You Some Erlang for Great Good, today posted on his blog about the problems around how rebar handles releases, Rebar Releases and Being Wrong. Th"/>
    <meta name="twitter:url" content="/sinan-releases-and-being-right/" />
    <meta name="twitter:site" content="@"/>

    <meta property="og:site_name" content="Erlware Blog" />
    <meta property="og:title" content="Sinan Releases and Being Right &middot; Erlware Blog" />
    <meta property="og:url" content="/sinan-releases-and-being-right/" />
    

    <meta property="og:type" content="article" />
    <meta property="og:description" content="Fred, of Learn You Some Erlang for Great Good, today posted on his blog about the problems around how rebar handles releases, Rebar Releases and Being Wrong. Th" />

    <meta property="article:published_time" content="2012-05-05T01:33:07Z" />
    <meta property="article:tag" content="Cowboy" /><meta property="article:tag" content="Erlang" /><meta property="article:tag" content="OTP" /><meta property="article:tag" content="rebar" /><meta property="article:tag" content="sinan" />


    <meta name="generator" content="Hugo 0.53" />

    <!-- Stylesheets -->
    <link rel="stylesheet" type="text/css" href="/built/screen.css" /> 
    <link rel="stylesheet" type="text/css" href="/css/casper-two.css" /> 
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" />
    

     

</head>


<body class="post-template">
  <div class="site-wrapper"> 

<header class="site-header outer">
  <div class="inner">
    <nav class="site-nav">
      <div class="site-nav-left">
        <a class="site-nav-logo" href="#"><img src="/img/logo.png" alt="Erlware Blog" /></a>

        <ul class="nav" role="menu">
        
        
        
            <li class="" role="menuitem">
              <a href="/">Home</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/about">About</a>
            </li>
        
      </ul></div>

      <div class="site-nav-right">
        <div class="social-links">
                    

                    

                    <a class="social-link" href="https://github.com/erlware" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>

                    

                    
        </div>  
            
      </div>

    </nav>  

  </div>
</header>

<main id="site-main" class="site-main outer" role="main">
  <div class="inner">
    
      <article class="post-full post"> 
    <header class="post-full-header">
        <section class="post-full-meta">
            <time class="post-full-meta-date" datetime="2012-05-05">5 May 2012</time>
                <span class="date-divider">/</span> <a href="/tags/cowboy/">#Cowboy</a>&nbsp;<a href="/tags/erlang/">#Erlang</a>&nbsp;
        </section>
        <h1 class="post-full-title">Sinan Releases and Being Right</h1>
    </header>
    
    <figure class="post-full-image" style="background-image: url(/defimg/3.jpg)">
    </figure>

    <section class="post-full-content">
        <div class="kg-card-markdown">
        <p><a href="http://ferd.ca/">Fred</a>, of <a href="http://learnyousomeerlang.com/" title="Learn You Some Erlang">Learn You Some Erlang for Great Good</a>, today posted on his blog about the problems around how rebar handles releases, <a href="http://ferd.ca/rebar-releases-and-being-wrong.html" title="Rebar Releases and Being Wrong">Rebar Releases and Being Wrong</a>. The problems he mentions and a few others are why, despite giving it a legitimate shot, I have found rebar unusable for my workflow to be efficient and stable while adhering to OTP standards at the same time.</p>

<p>I suggest first reading his post, if you already use rebar, and then continuing on with the rest of this.</p>

<p>I&rsquo;ll start with an example on the generation of a project containing two applications and a dependency from one of those applications of <a href="https://github.com/extend/cowboy" title="Cowboy">cowboy</a>. Next, I&rsquo;ll create a release (and in the process a deployable target system) to show the difference in how <a href="https://github.com/erlware/sinan" title="Sinan">sinan</a> handles this process.</p>

<p>TL;DR <a href="https://github.com/erlware/sinan" title="Sinan">Sinan</a> does OTP the right way, rebar does not.</p>

<p>First, you can download the latest version sinan from this <a href="https://github.com/downloads/erlware/sinan/sinan" title="Sinan Download">link</a>, it is simply an executable escript, so &lsquo;<em>chmod +x sinan</em>&rsquo; and put it in your <strong>PATH</strong> and you are good to go.</p>

<p>Sinan provides a &lsquo;gen&rsquo; command to create your project. I include the output of the steps I took to build this project. Sinan assumes this is a multiple application project, but if you give &ldquo;y&rdquo; instead it will create a directory structure similar to rebars default structure with a src/ directory instead of a lib/ directory.<br />
<pre style="color:#dcdccc;background-color:#3f3f3f;">$ sinan gen<br />
Please specify your name<br />
your name&gt; Tristan Sloughter<br />
Please specify your email address<br />
your email&gt; tristan@mashape.com<br />
Please specify the copyright holder<br />
copyright holder (&ldquo;Tristan Sloughter&rdquo;)&gt;<br />
Please specify name of your project<br />
project name&gt; rel_example<br />
Please specify version of your project<br />
project version&gt; 0.0.1<br />
Please specify the ERTS version (&ldquo;5.9&rdquo;)&gt;<br />
Is this a single application project (&ldquo;n&rdquo;)&gt;<br />
Please specify the names of the OTP apps that will be developed under this project. One application to a line. Finish with a blank line.<br />
app&gt; app_1<br />
app (&ldquo;&rdquo;)&gt; app_2<br />
app (&ldquo;&rdquo;)&gt;<br />
Would you like a build config? (&ldquo;y&rdquo;)&gt; y<br />
Project was created, you should be good to go!</pre><br />
We now have a project named rel_example and can see the generated contents.<br />
<pre style="color:#dcdccc;background-color:#3f3f3f;">$ cd rel_example/<br />
$ ls<br />
config  doc  lib  sinan.config</pre><br />
Before going further I add the line {include_erts, true}. to sinan.config so that a generated tarball of the release contains erts and can be booted on a machine without Erlang installed.<br />
<pre style="color:#dcdccc;background-color:#3f3f3f;"><span style="color:#bfebbf;">$ </span>cat sinan.config<br />
{project_name, rel_example}.<br />
{project_vsn, <span style="color:#cc9393;">&ldquo;0.0.1&rdquo;</span>}.</p>

<p>{build_dir,  <span style="color:#cc9393;">&ldquo;_build&rdquo;</span>}.</p>

<p>{ignore<em>dirs, [<span style="color:#cc9393;">&ldquo;</em>&ldquo;</span>, <span style="color:#cc9393;">&rdquo;.&rdquo;</span>]}.</p>

<p>{ignore_apps, []}.</p>

<p>{include_erts, true}.</pre><br />
A tree structure view of the generated project is below:<br />
<pre style="color:#dcdccc;background-color:#3f3f3f;">.<br />
├── config<br />
│   └── sys.config<br />
├── doc<br />
├── lib<br />
│   ├── app_1<br />
│   │   ├── doc<br />
│   │   ├── ebin<br />
│   │   │   └── overview.edoc<br />
│   │   ├── include<br />
│   │   └── src<br />
│   │       ├── app_1_app.erl<br />
│   │       ├── app_1.app.src<br />
│   │       └── app_1_sup.erl<br />
│   └── app_2<br />
│       ├── doc<br />
│       ├── ebin<br />
│       │   └── overview.edoc<br />
│       ├── include<br />
│       └── src<br />
│           ├── app_2_app.erl<br />
│           ├── app_2.app.src<br />
│           └── app_2_sup.erl<br />
└── sinan.config</pre><br />
You&rsquo;ll see we have a lib directory with two applications containing their source files under a src directory. Now in order to boot the release we&rsquo;ll create, we need to remove a couple tings from each supervisor. Instead of creating something for them to supervise just remove the variable AChild and replace [AChild] with [].</p>

<p>Next, so we have a third party dependency in the example, add cowboy to the applications in nano lib/app_1/src/app_1.app.src:<br />
<pre style="color:#dcdccc;background-color:#3f3f3f;">{applications, [kernel, stdlib, cowboy]},</pre><br />
Sinan provides a depends command to show the depenedencies of the project and where they are located:<br />
<pre style="color:#dcdccc;background-color:#3f3f3f;">$ sinan depends <span style="color:#7f9f7f;">-v</span><br />
<span style="color:#cc9393;">starting: depends</span><br />
Using the following lib directories to show resolved dependencies and where it found them:</p>

<pre><code>/home/tristan/.kerl/installs/r15b/lib  
/home/tristan/Devel/rel_example/_build/rel_example/lib  
</code></pre>

<p>compile time dependencies:</p>

<p>runtime dependencies:</p>

<pre><code>kernel                    2.15       : /home/tristan/.kerl/installs/r15b/lib/kernel-2.15  
stdlib                    1.18       : /home/tristan/.kerl/installs/r15b/lib/stdlib-1.18  
cowboy                    0.5.0      : /home/tristan/.kerl/installs/r15b/lib/cowboy-0.5.0  
</code></pre>

<p>project applications:</p>

<pre><code>app_1                     0.1.0      : /home/tristan/Devel/rel_example/_build/rel_example/lib/app_1-0.1.0  
app_2                     0.1.0      : /home/tristan/Devel/rel_example/_build/rel_example/lib/app_2-0.1.0&lt;/pre&gt;  
</code></pre>

<p>Now lets build a release and target system.<br />
<pre style="color:#dcdccc;background-color:#3f3f3f;">$ sinan dist</pre><br />
After running the dist command we have a _build directory that we find the following structure. I removed the files/dirs under each app to shorten the listing.<br />
<pre style="color:#dcdccc;background-color:#3f3f3f;">_build/<br />
├── rel_example<br />
│   ├── bin<br />
│   │   ├── rel_example<br />
│   │   └── rel_example-0.0.1<br />
│   ├── erts-5.9<br />
│   │   ├──<br />
│   ├── lib<br />
│   │   ├── app_1-0.1.0<br />
│   │   │   ├──<br />
│   │   ├── app_2-0.1.0<br />
│   │   │   ├──<br />
│   │   ├── cowboy-0.5.0<br />
│   │   │   ├──<br />
│   │   ├── kernel-2.15<br />
│   │   │   ├──<br />
│   │   └── stdlib-1.18<br />
│   │       ├──<br />
│   └── releases<br />
│       └── 0.0.1<br />
│           ├── rel_example.boot<br />
│           ├── rel_example.rel<br />
│           ├── rel_example.script<br />
│           └── sys.config<br />
└── tar<br />
    └── rel_example-0.0.1.tar.<span style="color:#e0cf9f;font-weight:bold;text-decoration:underline;">gz</span></pre><br />
Sinan has created a lib directory containing all necessary applications for our release as well as the needed files for booting the release. Additionally the dist command creates a tar.gz for easy deployment. But if we simply want to run our release where we are we can:<br />
<pre style="color:#dcdccc;background-color:#3f3f3f;">$ _build/rel_example/bin/rel_example<br />
Erlang R15B (erts-5.9)</p>

<p><span style="color:#8cd0d3;">[64-bit]</span> <span style="color:#f0dfaf;font-weight:bold;">[smp:4:4]</span> <span style="color:#8cd0d3;">[async-threads:0]</span> <span style="color:#f0dfaf;font-weight:bold;">[hipe]</span> <span style="color:#8cd0d3;">[kernel-poll:false]</span></p>

<p><span style="color:#bc8383;font-weight:bold;text-decoration:underline;">Eshell</span> V5.9  (abort with ^G)<br />
1&gt;</pre></p>

<p>This is only the tip of the iceberg of what sinan is capable of. I can&rsquo;t go into all of it here but I&rsquo;ll mention that you are able to define multiple releases for a project to generate and which of your project apps to include in each. Additionally you are able to provide a custom rel file if you require tweaks.</p>

<p>The important part to take away from this post is the structure of what you are working with when using sinan and how it is based on OTP standards, both for the source you work on and the results of the build process under _build/.</p>
    
        </div>
    </section>

    <footer class="post-full-footer">
      <section class="author-card">
        <img class="author-profile-image" src="/img/avatar.jpeg" alt="Author" />
        <section class="author-card-content">
            <h4 class="author-card-name"><a href="/">Tristan Sloughter</a></h4>
                <p></p>
        </section>
      </section>
    </footer>
</article>
    
    
    

  </div>
</main>


<aside class="read-next outer">
  <div class="inner">
    <div class="read-next-feed">      
      

      
      
    </div>
  </div>
</aside>

<div class="floating-header">
  <div class="floating-header-logo">
    <a href="/">
      <img src="/img/logo.png" alt="Erlware Blog" />
      <span>Erlware Blog</span>
    </a>
  </div>
  <span class="floating-header-divider">&mdash;</span>
  <div class="floating-header-title">Sinan Releases and Being Right</div>
  <div class="floating-header-share">
    <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
     <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/></svg>
    </div>
    
    <a class="floating-header-share-tw" href="https://twitter.com/share?text=Sinan%20Releases%20and%20Being%20Right&amp;url=%2fsinan-releases-and-being-right%2f"
          onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
      </a>
      <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=%2fsinan-releases-and-being-right%2f"
          onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>
      </a>
  </div>

  <progress class="progress" value="0">
    <div class="progress-container">
      <span class="progress-bar"></span>
    </div>
  </progress>
</div>



<footer class="site-footer outer">
  <div class="site-footer-content inner">
    <section class="copyright" style="line-height: 1.3em;">
      <a href="/"></a>  <br>
      
    </section>
    <nav class="site-footer-nav">
        <a href="/">Latest Posts</a>
        
        
        <a href="https://github.com/erlware" target="_blank" rel="noopener">Github</a>
        
        
    </nav>  
  </div>
</footer>

</div>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script type="text/javascript" src="//code.jquery.com/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="/js/jquery.fitvids.js"></script>

<script>hljs.initHighlightingOnLoad();</script>



    <script>





$(document).ready(function () {
    
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>
</body></html>
